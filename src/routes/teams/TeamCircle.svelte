<script lang="ts">
	import { Circle } from 'svelte-text-path';
	import { sineOut } from 'svelte/easing';
	import { tweened } from 'svelte/motion';
	import { symbolMap } from '../Cursor.svelte';
	import { onDestroy } from 'svelte';

	export let name: string;
	export let color: string;
	export let image: string;

	const cursorSymbol = Symbol(`team-cursor-${name}`);

	let spinning = false;

	$: symbolMap.update((map) => ({ ...map, [cursorSymbol]: spinning }));

	let rotation = tweened(0, { duration: 300, easing: sineOut });

	$: desiredRotation = spinning ? $rotation + 1.2 : null;
	$: desiredRotation && rotation.set(desiredRotation);

	onDestroy(() => {
		symbolMap.update((map) => {
			delete map[cursorSymbol];
			return map;
		});
	});
</script>

<a
	style="--bg: {color}; --rotation: {$rotation}deg"
	href="/teams/{name.toLowerCase()}"
	on:mouseenter={() => (spinning = true)}
	on:mouseleave={() => (spinning = false)}
>
	<div class="circle">
		<Circle>
			<tspan fill="white"
				>{@html name +
					'&nbsp;'.repeat(25 - name.length) +
					name +
					'&nbsp;'.repeat(25 - name.length)}</tspan
			>
		</Circle>
		<div class="innerCircle" />
	</div>
	<div class="icon">
		<div class="iconBG"></div>
		<img src="/icons/{name.toLowerCase()}.svg" alt="{name} Logo" />
	</div>
	<img
		class="imgHover"
		src={image}
		alt="{name} Display"
	/>
</a>

<style lang="scss">
	a {
		position: relative;
		margin: 0.4rem;
		border: 5px solid var(--bg);
		border-radius: 50%;
		max-width: 280px;
		min-width: 280px;
		aspect-ratio: 1 / 1;
	}

	.icon {
		position: absolute;
		width: 100%;
		height: 100%;
		left: 0px;
		top: 0px;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all cubic-bezier(0.075, 0.82, 0.165, 1) 0.5s;
	}

	.innerCircle {
		width: 80%;
		height: 80%;
		border-radius: 50%;
		position: absolute;
		top: 0px;
		left: 0px;
		transform: translate(10%, 10%);
		box-sizing: initial;
		border: 5px solid var(--bg);
		z-index: -1;
		opacity: 0;
		transition: all cubic-bezier(0.075, 0.82, 0.165, 1) 0.5s;
	}

	a:hover .innerCircle {
		opacity: 0.2;
	}

	a:hover .imgHover {
		opacity: 0.7;
		transform: scale(1.2);
		clip-path: circle(calc(50% / 1.2));
	}

	.imgHover {
		position: absolute;
		height: 300px;
		z-index: -2;
		user-select: none;
		pointer-events: none;
		top: 0121s;
		left: 0;
		filter: brightness(0.5);
		aspect-ratio: 1 / 1;
		object-fit: cover;
		clip-path: circle(50%);
		opacity: 0.3;
		transform: scale(0.85);
		transition: all cubic-bezier(0.075, 0.82, 0.165, 1) 0.5s;
	}

	.icon img {
		width: 25%;
		position: relative;
	}
	.iconBG {
		width: 30%;
		position: absolute;
		background: var(--bg);
		height: 30%;
		padding: 2rem;
		border-radius: 50%;
	}

	.circle {
		position: absolute;
		top: 0px;
		left: 0px;
		width: 100%;
		height: 100%;
		transform: rotate(var(--rotation));
	}

	a:hover {
		transition: all cubic-bezier(0.075, 0.82, 0.165, 1) 0.5s;
	}

	a:hover .icon {
		transform: scale(1.1);
	}
</style>
